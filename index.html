<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>DriveBridge - Secure Cloud File Transfer</title>
  <meta name="description" content="Secure, chunked file transfer between Google Drive and OneDrive with verbose logging">
  <meta name="author" content="DriveBridge">

  <!-- Security -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://apis.google.com https://accounts.google.com https://alcdn.msauth.net; connect-src 'self' https://www.googleapis.com https://graph.microsoft.com https://login.microsoftonline.com; style-src 'self' 'unsafe-inline'; img-src 'self'  https:; frame-src https://accounts.google.com https://login.microsoftonline.com;">
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">

  <!-- Favicon & Performance -->
  <link rel="icon" href="image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3Ctext y='.9em' font-size='90'%3Eüåâ%3C/text%3E%3C/svg%3E">
  <link rel="preconnect" href="https://apis.google.com">
  <link rel="preconnect" href="https://accounts.google.com">
  <link rel="preconnect" href="https://graph.microsoft.com">
  <link rel="preconnect" href="https://login.microsoftonline.com">

  <!-- External Libraries -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://alcdn.msauth.net/browser/2.30.0/js/msal-browser.min.js" crossorigin="anonymous"></script>

  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- AUTH VIEW -->
  <div id="auth-view" class="auth-container">
    <!-- ... your auth UI ... -->
  </div>

  <!-- DASHBOARD VIEW -->
  <div id="dashboard-view" class="dashboard" style="display:none;">
    <!-- ... your dashboard UI ... -->
  </div>

  <!-- PROGRESS PANEL, NOTIFICATIONS, OVERLAY -->
  <div id="transfer-progress" class="transfer-progress" style="display:none;">‚Ä¶</div>
  <div id="notifications" class="notifications"></div>
  <div id="modal-overlay" class="modal-overlay hidden"></div>

  <!-- Log startup -->
  <script>
    console.log('üöÄ DriveBridge v2.0 - Production Ready');
    console.log('üìä Chunked Transfer Engine: Enabled');
    console.log('üìù Verbose Logging: Enabled');
    console.log('üîí Security Headers: Active');
  </script>

  <!-- Application Scripts Loading -->

  <!-- 1/7: Config -->
  <script src="config.js"></script>

  <!-- 2/7: Emergency Inline Logger (bypasses broken logger.js) -->
  <script>
    console.log('üö® Loading emergency Logger...');
    class Logger {
      constructor() {
        this.logs = [];
        this.sessionId = 'session_' + Date.now();
        console.log('‚úÖ Emergency Logger initialized');
      }
      log(level, message, data, category) {
        const entry = {
          timestamp: new Date().toISOString(),
          level: level || 'INFO',
          message: message || '',
           data || {},
          category: category || 'GENERAL',
          id: Date.now() + Math.random()
        };
        this.logs.push(entry);
        console.log('[' + (level||'INFO') + '] [' + (category||'GENERAL') + '] ' + message, data);
        if (this.logs.length > 1000) this.logs = this.logs.slice(-500);
      }
      error(m,d,c){this.log('ERROR',m,d,c);}
      warn(m,d,c){this.log('WARN',m,d,c);}
      info(m,d,c){this.log('INFO',m,d,c);}
      debug(m,d,c){this.log('DEBUG',m,d,c);}
      transferStart(id,count){this.info('Transfer started',{id,count},'TRANSFER');}
      transferComplete(id,res){this.info('Transfer completed',{id,res},'TRANSFER');}
      fileTransferStart(){this.info('File transfer started','','FILE_TRANSFER');}
      fileTransferComplete(){this.info('File transfer completed','','FILE_TRANSFER');}
      chunkTransfer(){this.debug('Chunk transfer','','CHUNK_TRANSFER');}
      apiCall(){this.debug('API call','','API_CALL');}
      getRecentLogs(n){return this.logs.slice(-(n||10));}
      getFailedTransfers(){return[];}
      downloadLogFile(){return false;}
      clearLogs(){this.logs=[];console.log('Logs cleared');}
    }
    window.Logger = Logger;
    console.log('‚úÖ Emergency Logger ready');
  </script>

  <!-- 3/7: Disable the broken external logger.js -->
  <!-- <script src="logger.js"></script> -->

  <!-- 4/7: UI Manager -->
  <script src="ui-manager.js"></script>

  <!-- 5/7: Chunked Transfer Engine -->
  <script src="chunked-transfer.js"></script>

  <!-- 6/7: Error Handler -->
  <script src="error-handler.js"></script>

  <!-- 7/7: Main Application -->
  <script src="app.js"></script>

  <!-- Performance & Diagnostics -->
  <script>
    window.addEventListener('load', ()=>{
      if ('performance' in window) {
        const t= Math.round(performance.now());
        console.log(`‚ö° Load time: ${t}ms`);
      }
    });
  </script>
</body>
</html>
